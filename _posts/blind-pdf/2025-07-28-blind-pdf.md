---
layout: post
title: "Blind PDF"
date: 2025-07-28
tags: ["SSRF", "WEB"]
description: "A web application that converts HTML code into PDF documents. The goal is to leak the contents of `/etc/passwd` to get the flag."
comments: false
---

## Blind PDF

**Description:** A web application that converts HTML code into PDF documents. The goal is to leak the contents of `/etc/passwd` to get the flag.

## Vulnerability Analysis

The challenge involved a web application that accepts HTML code from users and converts it into PDF documents. This creates potential security issues because PDF generators often need to render resources such as images, stylesheets, and other elements referenced in the HTML.

The vulnerability exploited in this challenge is an SSRF (Server-Side Request Forgery) attack targeting the PDF generation process.

## Exploitation

The successful payload used CSS to load the `/etc/passwd` file as a background image:

```html
<!DOCTYPE html>
<html>
<head>
    <title>File Leaker</title>
    <style>
        @page {
            size: A4;
            margin: 0;
            background-image: url("file:///etc/passwd");
        }
    </style>
</head>
<body>
    <h1>Leaking /etc/passwd</h1>
    <p>Check the background of this page for the content of /etc/passwd</p>
</body>
</html>
```

### Why This Worked:

1. **CSS @page Rule**: The `@page` rule in CSS is used to modify the layout, size, and appearance of a page when printing. PDF generators respect these rules during the conversion process.

2. **Background Image**: By setting the `background-image` property to `url("file:///etc/passwd")`, we instruct the PDF generator to attempt to load the contents of the `/etc/passwd` file as an image.

3. **File Protocol Access**: Many PDF generators like wkhtmltopdf, WeasyPrint, and others run with permissions that allow them to access local files using the `file://` protocol.

4. **Text File as Image**: When a text file is loaded as an image, the PDF generator renders the text contents directly onto the page background, effectively leaking the file contents.

## Technical Details

### The PDF Generation Process

The web application likely uses one of several common HTML-to-PDF libraries:

- wkhtmltopdf
- WeasyPrint
- Puppeteer/Headless Chrome
- Prince XML

These libraries typically work by:

1. Rendering the HTML in a headless browser environment
2. Processing all resources (including CSS)
3. Converting the rendered page to PDF format

### The Vulnerability

The key vulnerability is that the PDF generator has access to the local filesystem and doesn't properly restrict access to sensitive files. When the `@page` CSS rule uses a `background-image` with the `file://` protocol, the generator attempts to load the file as an image resource.

Unlike other attempted methods (iframe, object, embed tags, etc.), the CSS background-image approach works because:

1. It's processed during the rendering/styling phase, not the content parsing phase
2. CSS processing often has different security restrictions than HTML processing
3. The `@page` rule specifically targets the print/PDF output process

## Mitigation Recommendations

To prevent this type of vulnerability:

1. Run PDF generators in sandboxed environments with restricted filesystem access
2. Disable the `file://` protocol in PDF generation libraries
3. Implement allowlists for resource loading rather than denylists
4. Filter user input to prevent CSS injection or restrict CSS properties that can load external resources
5. Validate and sanitize all user-provided HTML and CSS before processing

## Conclusion

This challenge demonstrates the dangers of processing user-supplied HTML/CSS in server-side applications, particularly when converting to other formats like PDF. The successful exploit leveraged the often-overlooked CSS processing capabilities of PDF generators to access sensitive system files.

